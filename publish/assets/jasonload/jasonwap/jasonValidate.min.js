/*
**author:jasonYang**
**web:jasonwap.zglingjie.com**
**email:914412726@qq.com**
*/
define("jasonwap/jasonValidate",["appframework","jasonwap/jasonUtil"],function(require,exports,module){var $=require("appframework"),util=require("jasonwap/jasonUtil"),jasonValidate=function(opt){opt=$.extend({},{src:"",submitBtn:"",callback:function(){}},opt);var isSuccess=!0,rules_params={valueType:"value"},validateFn=function(){var $src=$(opt.src);if($src.length<=0)return util.flashMask("节点不存在，请正确设置参数的src属性",5e3),!1;for(var $validate_elements=$src.find("[data-rules]"),i=0;i<$validate_elements.length;i++){var $ele_item=$($validate_elements[i]),rules=$ele_item.data("rules");try{var rules_obj=$.extend({},rules_params,eval("("+rules+")")),value=value="value"!=rules_obj.valueType?$ele_item.attr(rules_obj.valueType):util.isStrEmpty($ele_item.val())?"":$ele_item.val();if(rules_obj.required&&rules_obj.required.push()&&rules_obj.required[0]&&util.isStrEmpty(value)){util.flashMask(rules_obj.required[1]||"不能为空"),isSuccess=!1;break}if(rules_obj.number&&rules_obj.number.push()&&rules_obj.number[0]&&(isNaN(value)||util.isStrEmpty(value))){util.flashMask(rules_obj.number[1]||"必须为数值"),isSuccess=!1;break}if(rules_obj.min&&rules_obj.min.push()){if(isNaN(rules_obj.min[0]))throw"最小值必须是数值";if(value=parseFloat(value),isNaN(value)||util.isStrEmpty(value)||value<rules_obj.min[0]){util.flashMask(rules_obj.min[1]||"必须为不小于"+rules_obj.min[0]+"的数值"),isSuccess=!1;break}}if(rules_obj.max&&rules_obj.max.push()){if(isNaN(rules_obj.max[0]))throw"最大值必须是数值";if(value=parseFloat(value),isNaN(value)||util.isStrEmpty(value)||value>rules_obj.max[0]){util.flashMask(rules_obj.max[1]||"必须为不大于"+rules_obj.max[0]+"的数值"),isSuccess=!1;break}}if(rules_obj.radio&&rules_obj.radio.push()&&rules_obj.radio[0]&&(value=util.radioVal($ele_item.find("input[type=radio]")),util.isStrEmpty(value))){util.flashMask(rules_obj.radio[1]||"单选必选"),isSuccess=!1;break}}catch(err){util.flashMask("校验节点规则语法错误："+rules+"<br />("+err+")",5e3),isSuccess=!1}}return isSuccess&&"function"==typeof opt.callback&&opt.callback(),isSuccess};return util.isStrEmpty(opt.submitBtn)?validateFn():($submitBtn=$(opt.submitBtn),$submitBtn.length<=0?(util.flashMask("按钮节点不存在，请正确设置按钮节点参数submitBtn，不绑定按钮的话则不设置即可。",5e3),!1):void $submitBtn.unbind("click").bind("click",function(){return isSuccess=!0,validateFn()}))};module.exports=jasonValidate});
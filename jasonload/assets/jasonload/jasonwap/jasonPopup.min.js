/*
**author:jasonYang**
**web:jasonwap.zglingjie.com**
**email:914412726@qq.com**
*/
define("jasonwap/jasonPopup",["appframework","./jasonScrollbar","./css/jasonPopup.css?insertToFirst"],function(a,b,c){var d=a("./jasonScrollbar");!function(a){var b;a.jasonPopup=a.fn.jasonPopup=function(a){return new d(a)};var c=new Array,d=function(d){var e=this;e.popupNode=b,e.windowHeight=a.os.android?window.innerHeight>480?window.innerHeight:480:window.innerHeight,e.isLock=0,e.hasPopupPosition=0,e.isBlurPosition=!1,e.opt=a.extend({},{jasonPopupClass:"jasonPopup",bgStyle:"",boxStyle:"",title:"",titleStyle:"",titleLeftBtn:!1,titleLeftText:"取消",titleLeftStyle:"",titleLeftCallback:function(){},titleRightBtn:!1,titleRightText:"确定",titleRightStyle:"",titleRightCallback:function(){},message:"",messageStyle:"",btnStyle:"",cancelText:"取消",cancelStyle:"",cancelCallback:function(){},doneText:"确认",doneStyle:"",doneCallback:function(){},cancelOnly:!1,noBtn:d.position&&"center"!=d.position?!0:!1,isBgClick:!1,position:"center",height:"auto",duration:300,closeBtn:!1,closeText:"",closeStyle:"",closeCallback:function(){},isScroll:!0,onShow:function(){}},d),e.prepend(),c.push(e)};d.fn=d.prototype={prepend:function(){var b,d,e,f=this,g=f.opt.jasonPopupClass,h=f.opt.bgStyle,i=f.opt.boxStyle,j=f.opt.title,k=f.opt.titleStyle,b=f.opt.titleLeftBtn,l=f.opt.titleLeftText,m=f.opt.titleLeftStyle,n=f.opt.titleLeftCallback,d=f.opt.titleRightBtn,o=f.opt.titleRightText,p=f.opt.titleRightStyle,q=f.opt.titleRightCallback,r=f.opt.message,s=f.opt.messageStyle,t=f.opt.btnStyle,u=f.opt.cancelText,v=f.opt.cancelStyle,w=f.opt.cancelCallback,x=f.opt.doneText,y=f.opt.doneStyle,z=f.opt.doneCallback,A=f.opt.cancelOnly,B=f.opt.noBtn,C=f.opt.isBgClick,D=f.opt.position,E=f.opt.closeBtn,F=f.opt.closeText,G=f.opt.closeStyle,H=f.opt.closeCallback,I=f.opt.onShow,J=document.createElement("div");b=b?'<div class="jasonPopuptitleLeftBtn" style="'+m+'">'+l+"</div>":"",d=d?'<div class="jasonPopuptitleRightBtn" style="'+p+'">'+o+"</div>":"",e=E?'<div class="jasonPopupCloseBtn" style="'+G+'">'+F+"</div>":"";var K='<div class="jasonPopupBgDiv" style="z-index:'+(1e3+c.length)+";"+h+'"></div><div class="jasonPopupBox '+("center"==D?"jasonPopupBoxCenter":"bottom"==D?"jasonPopupBoxBottom":"top"==D?"jasonPopupBoxTop":"right"==D?"jasonPopupBoxRight":"jasonPopupBoxLeft")+'" style="z-index:'+(1001+c.length)+";"+i+'">'+(""==j?"":'<div class="jasonPopupTitle" style="'+k+'">'+b+j+d+e+"</div>")+'<div class="jasonPopupContent" style="'+s+'">'+r+"</div>";B||(K+='<ul class="jasonPopupBtn" style="'+t+'">	<li class="jasonPopupCancelBtn'+(A?" jasonPopupCancelOnlyBtn":"")+'" style="'+v+'">'+u+"</li>"+(A?"":'<li class="jasonPopupDoneBtn" style="'+y+'">'+x+'</li><li style="height:0;clear:both;"></li>')+"</ul>"),K+="</div>",J.innerHTML=K,f.popupNode=J,$el=a(J),$el.attr("class",g),a("body").append(J),B||($el.find(".jasonPopupBtn li").eq(0).bind("click",function(){w(),f.remove()}),A||$el.find(".jasonPopupBtn li").eq(1).bind("click",function(){z(),f.remove()})),C&&$el.find(".jasonPopupBgDiv").bind("click",function(){H(),f.remove()}),$el.find(".jasonPopuptitleLeftBtn").bind("click",function(){n(),f.remove()}),$el.find(".jasonPopuptitleRightBtn").bind("click",function(){q(),f.remove()}),$el.find(".jasonPopupCloseBtn").bind("click",function(){H(),f.remove()}),$el.bind("orientationchange",function(){var b=f.windowHeight>480?480:320;f.windowHeight=a.os.android?window.innerHeight>b?window.innerHeight:b:window.innerHeight,f.positionPopup()}),f.inputPosition(),a(window).bind("touchmove",function(a){a.preventDefault()}),f.opt.duration="center"==D?300:500,f.positionPopup(),I()},inputPosition:function(){var b=this;a(b.popupNode).find("input").unbind("focus").bind("focus",function(){if(a.os.android&&"bottom"!=b.opt.position){b.isBlurPosition=!1;var c=this,d=c.getBoundingClientRect().bottom,e=d-((b.windowHeight-260)/2+20)+b.hasPopupPosition;b.positionPopup(e),b.hasPopupPosition=e,a(c).unbind("blur").bind("blur",function(){b.isBlurPosition=!0,setTimeout(function(){b.isBlurPosition&&(b.positionPopup(),b.hasPopupPosition=0)},100)})}})},lock:function(){this.isLock=1},unlock:function(){this.isLock=0},show:function(){a(this.popupNode).show(),a(window).unbind("touchmove").bind("touchmove",function(a){a.preventDefault()})},hide:function(b){var c=this,d=c.opt.position,e=isNaN(b)?c.opt.duration:b,f=a(c.popupNode).find(".jasonPopupBox");f.css({"-webkit-transition-duration":e+"ms"});var g=f.css("center"==d?"top":d);f.css("center"==d?"top":d,"-100%"),setTimeout(function(){a(window).unbind("touchmove"),a(c.popupNode).hide(),f.css({"-webkit-transition-duration":"0ms"}),f.css("center"==d?"top":d,g)},e)},remove:function(b){var d=this;if(!d.isLock){var e=d.opt.position,f=isNaN(b)?d.opt.duration:b,g=a(d.popupNode).find(".jasonPopupBox");g.css({"-webkit-transition-duration":f+"ms"}),g.css("center"==e?"top":e,"-100%"),setTimeout(function(){c.splice(0,1),a(window).unbind("touchmove"),a(d.popupNode).unbind("orientationchange").remove(),c.length>0&&c[0].show()},f)}},positionPopup:function(b){var c=this;document.body.scrollTop=window.pageYOffset;var d=b?b:0,e=c.opt.position,f=a(c.popupNode).find(".jasonPopupBox"),g=c.opt.duration;f.css({display:"block","-webkit-transition-duration":g+"ms","transition-duration":g+"ms"});var h=f.width();h.indexOf("%")>0&&(h=h.substring(0,h.length-1)/100*window.innerWidth),f.css("right"==e?"right":"left","right"==e||"left"==e?0:(window.innerWidth-h)/2);var i=c.windowHeight,j=isNaN(c.opt.height)?f.offset().height/i:c.opt.height;j=j>1?1:j;var k=""==c.opt.title?0:f.find(".jasonPopupTitle").offset().height,l=c.opt.noBtn?0:f.find(".jasonPopupBtn").offset().height,m=(1-j)*i;if(("right"==e||"left"==e)&&f.css("-webkit-transition-duration","0ms"),f.find(".jasonPopupContent").css({height:i-k-l-m-d+"px",overflow:"hidden"}),c.opt.isScroll&&($el.find(".jasonPopupContent").jasonScrollbar(),c.inputPosition()),f.css("bottom"==e?"bottom":"top","bottom"==e?d:"top"==e?-d:(i-2*d-f.offset().height)/2),"right"==e||"left"==e)var n=function(){f.css("-webkit-transition-duration",g+"ms")};setTimeout(n,10)}}}(d),d.alertDlg=d.fn.alertDlg=function(a,b){return d.jasonPopup({title:"提示",message:'<div style="margin:0 3%;font-size:0.875em;">'+a+"</div>",cancelText:"确定",cancelCallback:b||function(){},cancelOnly:!0})},d.confirmDlg=d.fn.confirmDlg=function(a,b,c){return d.jasonPopup({title:"提示",message:'<div style="margin:0 3%;font-size:0.875em;">'+a+"</div>",doneText:"确定",doneCallback:b||function(){},cancelCallback:c||function(){}})},c.exports=d});
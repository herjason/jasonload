/*
**author:jasonYang**
**web:jasonwap.zglingjie.com**
**email:914412726@qq.com**
*/
define("jasonwap/jasonScrollbar",["appframework"],function(a,b,c){var d=a("appframework");!function(a){a.fn.jasonScrollbar=function(a){return new c(a,this)};var b=new Array,c=function(c,d){var e=this;e.element=a(d),e.opt={moveY:0,maxMoveY:0},e.scrollNode=null,e.barNode=null,e.barNodeHeight=0,e.barNodeLock=0,e.param=a.extend({},{isShowBar:!0},c),e.start(),b.push(e)};c.prototype={start:function(){var b,c,d=this,e=this.element,f=0,g=e.height();if(g.indexOf("%")>=0||isNaN(g)){var h=e.parent().height();g=(h>window.innerHeight?window.innerHeight:h)*parseFloat(g.replace("%",""))/100}var i=!1;"jasonScrollbar"!=e.css({overflow:"hidden",height:g+"px"}).children().eq(0).attr("scrollbarBox")&&(e.html('<div scrollbarBox="jasonScrollbar" style="width:100%;">'+e.html()+"</div>"),i=!0);var j=e.children().eq(0);if(d.scrollNode=j,d.opt.maxMoveY=g-j.height(),d.opt.maxMoveY=d.opt.maxMoveY>0?0:d.opt.maxMoveY,d.param.isShowBar){var k=e.css("position");if("absolute"!=k&&"fixed"!=k&&e.css("position","relative"),i){var l=document.createElement("div");e.append(l);var m=d.barNode=a(l);m.attr("barNode","yes")}else{var m=d.barNode=e.find("[barNode]");e.unbind("touchstart touchmove touchend")}var n=g*g/j.height();n=n>g?g:n,m.css({position:"absolute",top:"0",right:"2px",width:"5px",height:n+"px","background-color":"#000",opacity:"0.3","border-radius":"5px",display:"none"}),d.barNodeHeight=m.height()}e.bind("touchstart",function(a){a.stopPropagation(),j.css({"-webkit-transition-duration":"0s","transition-duration":"0s"}),d.barNodeLock=1,d.param.isShowBar&&(m.css({"-webkit-transition-duration":"0ms","transition-duration":"0ms"}),m.css("opacity","0.3"),m.show()),c=a.touches[0].pageY,f=a.touches[0].pageY-d.opt.moveY,b=a.timeStamp||Date.now()}),e.bind("touchmove",function(a){a.preventDefault(),a.stopPropagation(),d.barNodeScolling();var e=a.touches[0].pageY;d.opt.moveY=e-f,j.cssTranslate("0,"+d.opt.moveY+"px");var g=a.timeStamp||Date.now();g-b>300&&(c=e,b=g)}),e.bind("touchend",function(a){var e=(a.changedTouches[0].timeStamp||Date.now())-b,f=a.changedTouches[0].pageY-c;if(300>e&&Math.abs(f)>10&&d.opt.moveY<0&&d.opt.moveY>d.opt.maxMoveY){var g=d.momentum(f,e);d.opt.moveY+=g.dist,d.opt.moveY>0?d.opt.moveY=20:d.opt.moveY<d.opt.maxMoveY&&(d.opt.moveY=d.opt.maxMoveY-20),j.css({"-webkit-transition-duration":g.time+"ms","transition-duration":g.time+"ms"}),j.cssTranslate("0,"+d.opt.moveY+"px"),d.barNodeScolling(g.time),d.rebound(g.time)}else d.rebound()})},rebound:function(a){var b=this,c=0;a||(a=0),setTimeout(function(){$tmp=b.scrollNode,$tmp.css({"-webkit-transition-duration":"0.2s","transition-duration":"0.2s"}),b.opt.moveY>0?($tmp.cssTranslate("0,0"),b.opt.moveY=0,c=300):b.opt.moveY<b.opt.maxMoveY&&($tmp.cssTranslate("0,"+b.opt.maxMoveY+"px"),b.opt.moveY=b.opt.maxMoveY,c=300),b.barNodeScolling(c),b.barNodeLock=0,setTimeout(function(){if(!b.barNodeLock&&b.param.isShowBar){var a=b.barNode;a.css({"-webkit-transition-duration":"500ms","transition-duration":"500ms"}),a.css("opacity","0"),setTimeout(function(){b.barNodeLock||(a.hide(),a.css({"-webkit-transition-duration":"0ms","transition-duration":"0ms"}),a.css("opacity","0.3"))},500)}},c)},a)},momentum:function(a,b){var c=.001,d=Math.abs(a)/b,e=d*d/(2*c),f=d/c;return{dist:a>0?e:-e,time:f}},barNodeScolling:function(a){var b=this;if(b.param.isShowBar){var c=b.scrollNode,d=b.element,e=b.barNode;a||(a=0);var f=b.opt.moveY/(c.height()/d.height()),g=d.height()-5;e.css({"-webkit-transition-duration":a+"ms","transition-duration":a+"ms"}),e.cssTranslate("0,"+(f>0?0:-g>f?g:-f)+"px");var h=b.barNodeHeight-(f>0?f:f<-(g-b.barNodeHeight+5)?-(g-b.barNodeHeight+5)-f:0);h=5>h?5:h,e.css("height",h+"px")}}}}(d),c.exports=d});
/*
**author:jasonYang**
**web:jasonwap.zglingjie.com**
**email:914412726@qq.com**
*/
define("jasonweb/jasonValidate",["jquery","jasonweb/jasonUtil"],function(require,exports,module){var $=require("jquery"),util=require("jasonweb/jasonUtil"),jasonValidate=function(opt){opt=$.extend({},{src:"",submitBtn:"",callback:function(){}},opt);var isSuccess=!0,rules_params={valueType:"value"},validateFn=function(){var $src=$(opt.src);if($src.length<=0)return util.flashMask("节点不存在，请正确设置参数的src属性",5e3),!1;for(var $validate_elements=$src.find("[data-rules]"),$ele_item,i=0;i<$validate_elements.length;i++){$ele_item=$($validate_elements[i]);var rules=$ele_item.data("rules");try{var rules_obj=$.extend({},rules_params,eval("("+rules+")")),value=value="value"!=rules_obj.valueType?$ele_item.attr(rules_obj.valueType):util.isStrEmpty($ele_item.val())?"":$ele_item.val();if(rules_obj.required&&rules_obj.required.push()&&rules_obj.required[0]&&util.isStrEmpty(value)){util.flashMask(rules_obj.required[1]||"不能为空"),isSuccess=!1;break}if(rules_obj.radio&&rules_obj.radio.push()&&rules_obj.radio[0]&&(value=util.radioVal($ele_item.find("input[type=radio]")),util.isStrEmpty(value))){util.flashMask(rules_obj.radio[1]||"单选必选"),isSuccess=!1;break}if(util.isStrEmpty(value))continue;if(rules_obj.regExp&&rules_obj.regExp.push()&&!util.isStrEmpty(rules_obj.regExp[0])&&"string"==typeof rules_obj.regExp[0]){var pattern=new RegExp(rules_obj.regExp[0]);if(!pattern.test(value)){util.flashMask(rules_obj.regExp[1]||"正则表达式没通过"),isSuccess=!1;break}}if(rules_obj.number&&rules_obj.number.push()&&rules_obj.number[0]&&isNaN(value)){util.flashMask(rules_obj.number[1]||"必须为数值"),isSuccess=!1;break}if(rules_obj.min&&rules_obj.min.push()){if(isNaN(rules_obj.min[0]))throw"最小值必须是数值";if(isNaN(value)||value<rules_obj.min[0]){util.flashMask(rules_obj.min[1]||"必须为不小于"+rules_obj.min[0]+"的数值"),isSuccess=!1;break}}if(rules_obj.max&&rules_obj.max.push()){if(isNaN(rules_obj.max[0]))throw"最大值必须是数值";if(isNaN(value)||value>rules_obj.max[0]){util.flashMask(rules_obj.max[1]||"必须为不大于"+rules_obj.max[0]+"的数值"),isSuccess=!1;break}}if(rules_obj.len&&rules_obj.len.push()&&"number"==typeof rules_obj.len[0]&&value.length!=rules_obj.len[0]){util.flashMask(rules_obj.len[1]||"长度必须为"+rules_obj.len[0]),isSuccess=!1;break}if(rules_obj.minLen&&rules_obj.minLen.push()&&"number"==typeof rules_obj.minLen[0]&&value.length<rules_obj.minLen[0]){util.flashMask(rules_obj.minLen[1]||"最小长度必须为"+rules_obj.minLen[0]),isSuccess=!1;break}if(rules_obj.maxLen&&rules_obj.maxLen.push()&&"number"==typeof rules_obj.maxLen[0]&&value.length>rules_obj.maxLen[0]){util.flashMask(rules_obj.maxLen[1]||"最大长度只能为"+rules_obj.maxLen[0]),isSuccess=!1;break}if(rules_obj.email&&rules_obj.email.push()&&rules_obj.email[0]&&!/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9_\-])+\.)+[a-zA-Z0-9]{2,5}$/.test(value+"")){util.flashMask(rules_obj.email[1]||"邮箱格式不正确"),isSuccess=!1;break}}catch(err){util.flashMask("校验节点规则语法错误："+rules+"<br />("+err+")",5e3),isSuccess=!1}}return isSuccess||$ele_item.focus(),isSuccess&&"function"==typeof opt.callback&&opt.callback(),isSuccess};return util.isStrEmpty(opt.submitBtn)?validateFn():($submitBtn=$(opt.submitBtn),$submitBtn.length<=0?(util.flashMask("按钮节点不存在，请正确设置按钮节点参数submitBtn，不绑定按钮的话则不设置即可。",5e3),!1):void $submitBtn.unbind("click").bind("click",function(){return isSuccess=!0,validateFn()}))};module.exports=jasonValidate});